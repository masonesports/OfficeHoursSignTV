<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Office Hours Schedule</title>
	<!-- Updated: 2025-09-26 23:12 -->
	<link rel="stylesheet" href="static/style.css">
	<style>
		* {
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
			background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
			margin: 0;
			padding: 2vh;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.container {
			background-color: white;
			padding: 4vh 3vw;
			border-radius: 2vh;
			box-shadow: 0 1vh 3vh rgba(0, 0, 0, 0.2);
			width: 90vw;
			max-width: 50vh;
			text-align: center;
		}

		h1 {
			font-size: 4vh;
			font-weight: 700;
			margin: 0 0 3vh 0;
			color: #2E7D32;
			text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
		}

		.status {
			font-size: 3.5vh;
			font-weight: 800;
			text-align: center;
			margin-bottom: 4vh;
			padding: 2vh 3vw;
			border-radius: 1.5vh;
			text-transform: uppercase;
			letter-spacing: 0.1em;
			box-shadow: 0 0.5vh 1vh rgba(0, 0, 0, 0.1);
		}

		.status.open {
			background: linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 100%);
			color: #1B5E20;
			border: 0.3vh solid #4CAF50;
		}

		.status.closed {
			background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
			color: #B71C1C;
			border: 0.3vh solid #F44336;
		}

		.schedule {
			display: flex;
			flex-direction: column;
			gap: 1.5vh;
		}

		.schedule .row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
			padding: 2vh 3vw;
			border-radius: 1vh;
			border-left: 0.5vh solid #4CAF50;
			box-shadow: 0 0.3vh 0.8vh rgba(0, 0, 0, 0.1);
			transition: transform 0.2s ease;
		}

		.schedule .row.closed {
			border-left: 0.5vh solid #F44336;
		}

		.schedule .row:hover {
			transform: translateY(-0.2vh);
		}

		.schedule .day {
			font-size: 2.8vh;
			font-weight: 600;
			color: #2E7D32;
			flex: 1;
			text-align: left;
		}

		.schedule .day.closed {
			color: #B71C1C;
		}

		.schedule .time {
			font-size: 2.5vh;
			font-weight: 500;
			color: #495057;
			text-align: right;
			min-width: 8vw;
		}

		.schedule .time.closed {
			color: #B71C1C;
		}

		.hint {
			font-size: 1.8vh;
			color: #6C757D;
			margin-top: 3vh;
			font-style: italic;
		}

		/* Responsive adjustments for very tall screens */
		@media (min-height: 120vh) {
			.container {
				padding: 3vh 2vw;
			}
			
			h1 {
				font-size: 3.5vh;
				margin-bottom: 2vh;
			}
			
			.status {
				font-size: 3vh;
				margin-bottom: 3vh;
				padding: 1.5vh 2vw;
			}
			
			.schedule .day {
				font-size: 2.5vh;
			}
			
			.schedule .time {
				font-size: 2.2vh;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>GMU Esports Office Hours</h1>
		<div id="status" class="status">Loading...</div>
		<div id="schedule" class="schedule"></div>
	</div>
	<script>
		const WEEKDAYS = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
		function startOfWeekMonday(d){ const c=new Date(d); const day=c.getDay(); const diff=(day+6)%7; c.setDate(c.getDate()-diff); c.setHours(0,0,0,0); return c; }
		function fmtMMDD(d){ const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${m}/${day}`; }
		
		function isOfficeOpenNow(model) {
			const now = new Date();
			const dayName = WEEKDAYS[now.getDay() - 1]; // Convert Sunday=0 to Monday=0
			const dstr = fmtMMDD(now);
			
			// Check for date-specific override first
			const overrides = (model && model.overrides) || {};
			const defaults = (model && model.default) || {};
			
			let schedule = overrides[dstr];
			if (schedule === undefined || schedule === "") {
				schedule = defaults[dayName] || "";
			}
			
			// If closed or no schedule, office is closed
			if (!schedule || schedule.toLowerCase().includes('closed')) {
				return false;
			}
			
			// Parse time range (e.g., "12PM - 5PM", "2:00 PM - 5:00 PM")
			const timeMatch = schedule.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM)\s*-\s*(\d{1,2}):?(\d{2})?\s*(AM|PM)/i);
			if (!timeMatch) {
				return false; // Can't parse time, assume closed
			}
			
			const [, startHour, startMin, startPeriod, endHour, endMin, endPeriod] = timeMatch;
			
			// Convert to 24-hour format
			function to24Hour(hour, min, period) {
				let h = parseInt(hour);
				const m = parseInt(min || '0');
				if (period.toUpperCase() === 'PM' && h !== 12) h += 12;
				if (period.toUpperCase() === 'AM' && h === 12) h = 0;
				return h * 60 + m; // Convert to minutes since midnight
			}
			
			const startMinutes = to24Hour(startHour, startMin, startPeriod);
			const endMinutes = to24Hour(endHour, endMin, endPeriod);
			const currentMinutes = now.getHours() * 60 + now.getMinutes();
			
			return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
		}
		
		function updateStatus(model) {
			const statusEl = document.getElementById("status");
			const isOpen = isOfficeOpenNow(model);
			statusEl.textContent = isOpen ? 'OPEN' : 'CLOSED';
			statusEl.className = `status ${isOpen ? 'open' : 'closed'}`;
		}
		
		async function loadSchedule(){
			try{
				// Try API first (for local development), then fallback to JSON file (for GitHub Pages)
				let res = await fetch("/api/schedule?t=" + Date.now(), { cache: "no-store" });
				if(!res.ok) {
					res = await fetch("schedule.json?t=" + Date.now(), { cache: "no-store" });
				}
				if(!res.ok) throw new Error("Failed to load schedule");
				const data = await res.json();
				updateStatus(data);
				renderEffective(data||{});
			}catch(err){ 
				updateStatus({}); 
				renderEffective({}); 
			}
		}
		
		function renderEffective(model){
			const defaults = (model && model.default) || Object.fromEntries(WEEKDAYS.map(d=>[d,""]));
			const overrides = (model && model.overrides) || {};
			const container = document.getElementById("schedule");
			container.innerHTML = "";
			
			const monday = startOfWeekMonday(new Date());
			
			WEEKDAYS.forEach((dayName,i)=>{
				const d = new Date(monday); d.setDate(monday.getDate()+i);
				const dstr = fmtMMDD(d);
				const overridden = overrides[dstr];
				const effective = (overridden!==undefined && overridden!=="") ? overridden : (defaults[dayName]||"");
				const isClosed = !effective || effective.toLowerCase().includes("closed");
				
				const row = document.createElement("div"); 
				row.className = `row ${isClosed ? "closed" : ""}`;
				const dayEl = document.createElement("div"); 
				dayEl.className = `day ${isClosed ? "closed" : ""}`; 
				dayEl.textContent = `${dayName} (${dstr})`;
				const timeEl = document.createElement("div"); 
				timeEl.className = `time ${isClosed ? "closed" : ""}`; 
				timeEl.textContent = effective || "â€”";
				row.appendChild(dayEl); row.appendChild(timeEl); container.appendChild(row);
			});
		}
		
		loadSchedule();
		// Update status every minute
		setInterval(() => {
			fetch("/api/schedule", { cache: "no-store" })
				.then(res => {
					if(!res.ok) return fetch("schedule.json?t=" + Date.now(), { cache: "no-store" });
					return res;
				})
				.then(res => res.json())
				.then(data => updateStatus(data))
				.catch(err => console.error(err));
		}, 60000);
	</script>
</body>
</html>


