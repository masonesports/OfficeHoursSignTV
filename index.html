<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Office Hours Schedule</title>
	<link rel="stylesheet" href="static/style.css">
	<style>
		/* Minimal fallback if CSS not found */
		.no-style body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
	</style>
</head>
<body>
	<div class="container">
		<h1>GMU Esports Office Hours Schedule</h1>
		<div id="schedule" class="schedule"></div>
		<p class="hint">This page uses <code>schedule.json</code> (default + date overrides). Shows current week.</p>
	</div>
	<script>
		const WEEKDAYS = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
		function startOfWeekMonday(d){ const c=new Date(d); const day=c.getDay(); const diff=(day+6)%7; c.setDate(c.getDate()-diff); c.setHours(0,0,0,0); return c; }
		function fmtMMDD(d){ const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${m}/${day}`; }
		async function loadSchedule(){
			try{
				const res = await fetch("schedule.json", { cache: "no-store" });
				if(!res.ok) throw new Error("Failed to load schedule.json");
				const data = await res.json();
				renderEffective(data||{});
			}catch(err){ console.error(err); renderEffective({}); }
		}
		function renderEffective(model){
			const defaults = (model && model.default) || Object.fromEntries(WEEKDAYS.map(d=>[d,""]));
			const overrides = (model && model.overrides) || {};
			const container = document.getElementById("schedule");
			container.innerHTML = "";
			const monday = startOfWeekMonday(new Date());
			WEEKDAYS.forEach((dayName,i)=>{
				const d = new Date(monday); d.setDate(monday.getDate()+i);
				const dstr = fmtMMDD(d);
				const overridden = overrides[dstr] && overrides[dstr][dayName];
				const effective = (overridden!==undefined && overridden!=="") ? overridden : (defaults[dayName]||"");
				const row = document.createElement("div"); row.className = "row";
				const dayEl = document.createElement("div"); dayEl.className = "day"; dayEl.textContent = `${dayName} (${dstr})`;
				const timeEl = document.createElement("div"); timeEl.className = "time"; timeEl.textContent = effective || "â€”";
				row.appendChild(dayEl); row.appendChild(timeEl); container.appendChild(row);
			});
		}
		loadSchedule();
	</script>
</body>
</html>


